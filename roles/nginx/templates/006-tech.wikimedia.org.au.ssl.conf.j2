#
# tech.{{ wmau_domain }}
#
server {
  listen 80;
  listen [::]:80;
  server_name tech.{{ wmau_domain }};
  return 301 https://tech.{{ wmau_domain }}$request_uri;
}

server {
  listen 443 ssl;
  listen [::]:443 ssl;

{% if not is_snakeoil %}
  ssl_certificate /etc/letsencrypt/live/tech.{{ wmau_domain }}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/tech.{{ wmau_domain }}/privkey.pem;

  ssl_stapling on;
  ssl_stapling_verify on;
  ssl_dhparam /etc/ssl/dhparam.pem;
  ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
  ssl_prefer_server_ciphers on;
  ssl_session_cache shared:TLS:2m;
{% else %}
  #
  # Self signed certs generated by the ssl-cert package
  # Don't use them in a production server!
  #
  include snippets/snakeoil.conf;
{% endif %}

  server_name tech.{{ wmau_domain }};

  root /var/www/nginx;

  location /.well-known {
    alias /var/www/nginx/.well-known;
  }

  location / {
    return 301 https://{{ wmau_domain }}$request_uri;
  }
}
